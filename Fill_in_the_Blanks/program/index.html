<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Section 4 — Spelling Activity</title>

<style>
html,body{
  height:100%;
  margin:0;
  padding:0;
  font-family:"Comic Sans MS", cursive;
  overflow:hidden;
}

body {
  background: url("../Assets/c5i5_1nty_230703.jpg") no-repeat center center fixed;
  background-size: cover;
}

/* Heading */
.page-title {
  text-align:center;
  font-size:32px;
  font-weight:bold;
  margin-top:15px;
  color:#222;
}

/* Board */
.board-area {
  position:absolute;
  top:23%;
  left:50%;
  transform:translateX(-50%);
  width:72%;
  height:58%;
  display:flex;
  justify-content:center;
  align-items:center;
}

.content-box {
  width:90%;
  height:90%;
  display:flex;
  flex-direction:column;
  align-items:center;
}

/* Slides */
.slide {
  display:none;
  flex-direction:column;
  align-items:center;
  gap:14px;
}
.slide.active { display:flex; }

.prompt {
  font-size:22px;
  font-weight:bold;
  color:#222;
  text-align:center;
}

/* Letter boxes */
.blanks {
  display:flex;
  gap:12px;
  flex-wrap:wrap;
  justify-content:center;
}

.letter-box {
  width:60px;
  height:60px;
  border-radius:10px;
  background:#fff;
  border:3px solid #ccc;
  display:flex;
  align-items:center;
  justify-content:center;
  box-shadow:0 4px 10px rgba(0,0,0,0.1);
}

.letter-box.correct { border-color:#2ecc71 !important; }
.letter-box.wrong   { border-color:#e74c3c !important; }

.letter-input {
  width:100%;
  height:100%;
  outline:none;
  border:none;
  background:transparent;
  text-align:center;
  font-size:30px;
  font-weight:bold;
  text-transform:uppercase;
}

/* Buttons */
.controls {
  display:flex;
  gap:12px;
  margin-top:10px;
}

button {
  background:#ff8c42;
  border:none;
  padding:10px 18px;
  color:white;
  font-weight:bold;
  border-radius:10px;
}
button.secondary { background:#777; }

.message {
  margin-top:8px;
  font-weight:bold;
  font-size:20px;
  min-height:28px;
}

/* CONFETTI */
.confetti {
  position: fixed;
  top: -10px;
  width: 14px;
  height: 14px;
  z-index: 999999;
  animation: fall linear forwards;
  pointer-events:none;
}
@keyframes fall {
  to { transform: translateY(110vh) rotate(720deg); opacity:0; }
}

/* Flash correct/wrong */
.correct-flash { animation: flashGreen 0.45s; }
@keyframes flashGreen {
  0% { background: rgba(0,255,0,0.20); }
  100% { background: transparent; }
}

.wrong-flash { animation: flashRed 0.45s; }
@keyframes flashRed {
  0% { background: rgba(255,0,0,0.20); }
  100% { background: transparent; }
}

</style>
</head>

<body>

<div class="page-title">Fill the Blank by Spelling the Word!</div>

<div class="board-area">
  <div class="content-box">

    <div id="slidesContainer"></div>

    <div class="controls">
      <button id="prevBtn" class="secondary">⬅ Previous</button>
      <button id="nextBtn" class="secondary">Next ➡</button>
    </div>

    <div class="message" id="globalMessage"></div>
  </div>
</div>

<audio id="successSound" src="../Assets/success-340660.mp3"></audio>
<audio id="errorSound" src="../Assets/error-126627.mp3"></audio>

<script>
/* British MALE Accent */
function speakBritish(text) {
  if (!text) return;
  const u = new SpeechSynthesisUtterance(text);
  u.lang = "en-GB";
  u.pitch = 0.65;  
  u.rate = 0.95;
  speechSynthesis.cancel();
  speechSynthesis.speak(u);
}

/* CONFETTI */
function confettiBurst(count=80) {
  for (let i=0; i<count; i++) {
    const c=document.createElement("div");
    c.className="confetti";
    c.style.left = Math.random()*100 + "vw";
    c.style.background = `hsl(${Math.random()*360},100%,50%)`;
    c.style.animationDuration = (1 + Math.random()*1.5) + "s";
    document.body.appendChild(c);
    setTimeout(()=>c.remove(),2500);
  }
}

/* QUESTIONS */
const QUESTIONS=[
  { template:"A frog can live both on {blank} and in water", answer:"LAND" },
  { template:"Some animals like dog live in {blank} shelters", answer:"MANMADE" },
  { template:"Aquatic animals live in {blank}", answer:"WATER" },
  { template:"Bears eat both {blank} and the flesh of other animals", answer:"PLANTS" },
  { template:"Birds fly with the help of their {blank}", answer:"WINGS" }
];

const slidesContainer=document.getElementById("slidesContainer");
const prevBtn=document.getElementById("prevBtn");
const nextBtn=document.getElementById("nextBtn");
const slides=[];

/* CLEAR SLIDE */
function clearSlide(slide){
  const inputs = slide.querySelectorAll(".letter-input");
  const boxes = slide.querySelectorAll(".letter-box");

  inputs.forEach(i => i.value = "");
  boxes.forEach(b => b.classList.remove("correct","wrong"));
  slide.querySelector(".message").innerHTML = "";
}

/* BUILD SLIDES */
QUESTIONS.forEach((q,idx)=>{
  const slide=document.createElement("div");
  slide.className="slide";
  slide.dataset.answer=q.answer;

  const blanks="_ ".repeat(q.answer.length);

  const prompt=document.createElement("div");
  prompt.className="prompt";
  prompt.innerHTML=q.template.replace("{blank}", blanks);
  slide.appendChild(prompt);

  const blanksDiv=document.createElement("div");
  blanksDiv.className="blanks";

  [...q.answer].forEach((_,i)=>{
    const box=document.createElement("div");
    box.className="letter-box";

    const input=document.createElement("input");
    input.className="letter-input";
    input.maxLength=1;

    /* auto next + auto check at last box */
    input.addEventListener("input", ()=>{
      input.value=input.value.toUpperCase();

      const nextInput = blanksDiv.children[i+1]?.querySelector("input");
      if (input.value && nextInput) nextInput.focus();

      if (i === q.answer.length-1 && input.value) {
        checkSlide();
      }
    });

    /* auto back with backspace */
    input.addEventListener("keydown", e=>{
      if (e.key==="Backspace" && !input.value && i>0) {
        blanksDiv.children[i-1].querySelector("input").focus();
      }
    });

    box.appendChild(input);
    blanksDiv.appendChild(box);
  });

  slide.appendChild(blanksDiv);

  const msg=document.createElement("div");
  msg.className="message";
  slide.appendChild(msg);

  slides.push(slide);
  slidesContainer.appendChild(slide);
});

/* SHOW SLIDE */
let current=0;
showSlide(0);

function showSlide(i){
  slides.forEach((s,idx)=>s.classList.toggle("active", idx===i));
  current=i;

  prevBtn.disabled=(i===0);
  nextBtn.disabled=(i===slides.length-1);

  /* Speak question (skip blanks) */
  const raw = QUESTIONS[i].template.replace("{blank}", "");
  speakBritish(raw);

  setTimeout(()=>{
    slides[i].querySelector(".letter-input").focus();
  }, 150);
}

/* CHECK ANSWER */
function checkSlide(){
  const slide=slides[current];
  const expected=slide.dataset.answer;
  const inputs=[...slide.querySelectorAll(".letter-input")];
  const boxes=[...slide.querySelectorAll(".letter-box")];
  const letters=inputs.map(i=>i.value).join("");

  if (letters !== expected) {
    slide.classList.add("wrong-flash");
    setTimeout(()=>slide.classList.remove("wrong-flash"),400);

    slide.querySelector(".message").style.color="red";
    slide.querySelector(".message").innerHTML="Wrong! Try again ✖";

    document.getElementById("errorSound").play();
    speakBritish("Incorrect. Try again.");

    /* CLEAR AFTER WRONG */
    setTimeout(()=>{
      clearSlide(slide);
      slide.querySelector(".letter-input").focus();
    },600);

    return;
  }

  /* Correct */
  slide.classList.add("correct-flash");
  setTimeout(()=>slide.classList.remove("correct-flash"),400);

  slide.querySelector(".message").style.color="green";
  slide.querySelector(".message").innerHTML="Correct! ✔";

  boxes.forEach(b=>b.classList.add("correct"));

  document.getElementById("successSound").play();
  speakBritish("Correct. The answer is " + expected);
  confettiBurst();

  /* auto-next */
  setTimeout(()=>{
    if (current < slides.length-1) {
      clearSlide(slides[current]);
      showSlide(current+1);
    }
  },600);
}

/* Navigation */
prevBtn.addEventListener("click", ()=>{
  if (current > 0) {
    clearSlide(slides[current-1]);
    showSlide(current-1);
  }
});

nextBtn.addEventListener("click", ()=>{
  if (current < slides.length-1) {
    clearSlide(slides[current+1]);
    showSlide(current+1);
  }
});

</script>
</body>
</html>
